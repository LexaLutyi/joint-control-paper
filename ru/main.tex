\input{article_header}

\title{Совместное управление}
\author{Самарин Алексей}
\date{Апрель 2022}

\begin{document}

\maketitle

% \section{План}

% Основная идея: два агента управляют одной системой.
% Задача управления - расстояние между агентами должно соответствовать входу.
% Показать, что применение нелинейного наблюдателя помогает улучшить управление.

% \begin{enumerate}
%     \item Введение
%     \item Описание системы, объяснить, что задача слежения, чтобы управление было не 0
%     \item Подход через линейный наблюдатель
%     \item Подход через нелинейный наблюдатель (посмотреть, что удастся доказать)
%     \item (Можно попробовать не задачу слежения, а лидера - другое управление)
%     \item Обсуждение
% \end{enumerate}

\section{Introduction}
% setting direction
% Обозначить широкую проблему

% Кто аудитория
%  + специалисты теории управления
%  + Интересуются мультиагентными системами
\textbf{Openning}
Одной системой могут управлять несколько агентов,
между которыми нет коммуникации [попробовать найти пример]. 
Когда фазовый вектор системы неизвестен,
то для управления требуется наблюдатель, 
в котором используется известное управление. 
Однако в системах без коммуникации, 
агент не знает управление других агентов, 
поэтому оно становится помехой при наблюдении. 
Существуют нелинейные наблюдатели, 
позволяющие отфильтровать ограниченную помеху. 
Можно ли применять такие наблюдатели 
в мультиагентных системах, 
чтобы учесть управление других агентов?

\textbf{Funnel}
Для мультиагентных линейных систем без коммуникации
при решении задачи стабилизации достаточно линейного наблюдателя,
так как в установившемся режиме управление агентов равно нулю,
поэтому оно не влияет на ошибку наблюдения [Статья о консенсусе](appendix?).
Однако существуют задачи (например задача слежения),
когда в установившемся режиме управление не равно нулю, но ограничено.
Тогда в линейном наблюдателе возникнет неустранимая ограниченная помеха,
которая будет влиять на качество управления.
Для линейных систем с ограниченной помехой
известны каскадные наблюдатели,
которые за конечное время дают точную оценку ошибки линейного наблюдателя
[Ссылка на каскадные наблюдатели].
Но в переходном процессе управление может значительно превышать
ограничение, заложенное в каскадном наблюдателе.
Более того возникает положительная обратная связь:
большое управление ведет к большой ошибке каскадного наблюдателя,
которая ведет к росту управления (appendix?).

\textbf{Challenge}
% what knowledge you hope to gain?
Как использовать каскадный наблюдатель,
когда в переходном режиме возникает положительная обратная связь,
а в установившемся помеха имеет априорное ограничение?
Наш подход состоит в сатурации какскадного наблюдателя
при подстановке в управление.
Тем самым разрывается положительная обратная связь,
что позволяет системе перейти в установившейся режим,
где каскадный наблюдатель работает правильно.

\section{Постановка задачи}

\textbf{Линейный наблюдатель}

\textbf{Каскадный наблюдатель}

\textbf{Итоговая система с сатурацией, вопрос - когда устойчива?}

\section{Результаты}

\textbf{Алгоритм подбора матриц и констант}

\textbf{Теорема об работоспособности}

\section{Обсуждение}

\rule{\textwidth}{1pt}

\section{Мотивация}
Дана система из двух агентов:
\begin{equation*}
    \begin{gathered}
        \dot{x}_1 = A x_1 + B u_1\\
        \dot{x}_2 = A x_2 + B u_2\\
        y = C (x_1 - x_2)
    \end{gathered}
\end{equation*}
каждый агент измеряет только относительный выход $y$.

Требуется решить задачу слежения: $y(t) \to g(t)$.
$g(t)$ --- неизвестный заранее непрерывный ограниченный сигнал.

Обозначим $z = x_1 - x_2$
\begin{equation*}
    \begin{gathered}
        \dot{z} = A z + B u_1 - B u_2\\
        y = C z
    \end{gathered}
\end{equation*}

Агентам требуется совместно управлять системой.
Проблема заключается в том, что регулятор, 
генерирующий $u_1$ не знает о $u_2$ и наоборот.

% \begin{enumerate}
%     \item Как решить задачу слежения в линейном случае,
%     когда $x$ известна. (как обычно, только делим управление на 2).
%     \item Добавляем линейный наблюдатель и смотрим падение качества управления,
%     сначала, который знает всю инфу, затем, который знает только о своем управлении.
%     \item Добавляем нелинейный наблюдатель. Что будет.
% \end{enumerate}
\section{Постановка задачи}
\begin{equation*}
\begin{cases}
    \dot{x} = A x + B u_1 + B u_2\\
    y = C x\\
    y \to g
\end{cases}
\end{equation*}

Пусть 
\begin{equation*}
    \begin{gathered}
        u_1 = u_2 = K (x - w)
        % u_2 = -K (x - w)
    \end{gathered}
\end{equation*}

где $w(t)$ определяется на основе $g(t)$. 
Тогда $A + 2 B K$ должна быть устойчивой.

\subsection{Стандартный наблюдатель}
Если бы регуляторы знали состояние друг друга,
то можно было бы построить обычный наблюдатель.
\begin{equation*}
    \begin{cases}
        \dot{x} = A x + B K (\hat{x}_1 - w) + B K (\hat{x}_2 - w)\\
        \dot{\hat{x}}_1 = A x_1 + B K (\hat{x}_1 - w) + B K (\hat{x}_2 - w) +
        F (C \hat{x}_1 - y)\\
        \dot{\hat{x}}_2 = A x_2 + B K (\hat{x}_1 - w) + B K (\hat{x}_2 - w) +
        F (C \hat{x}_2 - y)
    \end{cases}
\end{equation*}
Наблюдателей 2, так как предполагается, что они реализуются разными устройствами.
Ошибка наблюдения подчиняется уравнению
\begin{equation*}
    \dot{e}_i = (A + F C) e_i,\ i \in \{1,2\}
\end{equation*}

\subsection{Изолированный наблюдатель}
Когда регуляторы не могут передавать информацию,
то построение стандартного наблюдателя невозможно.

\begin{equation*}
\begin{gathered}
    \begin{cases}
        \dot{x} = A x + B K (\hat{x}_1 - w) + B K (\hat{x}_2 - w)\\
        \dot{\hat{x}}_1 = A x_1 + 
            B K (\hat{x}_1 - w) + 
            \cancel{B K (\hat{x}_2 - w)} +
            F (C \hat{x}_1 - y)\\
        \dot{\hat{x}}_2 = A x_2 +
            \cancel{B K (\hat{x}_1 - w)} + 
            B K (\hat{x}_2 - w) +
            F (C \hat{x}_2 - y)
    \end{cases}\\
    \Downarrow\\
    \begin{cases}
        \dot{e}_1 = (A + F C) e_1 + B K (\hat{x}_2 - w)\\
        \dot{e}_2 = (A + F C) e_2 + B K (\hat{x}_1 - w)
    \end{cases}
\end{gathered}
\end{equation*}

В наблюдателе всегда будет присутствовать ошибка,
которая будет передаваться в управление,
что приведет к большей ошибке слежения.
Вопрос, когда можно подобрать матрицы $K, F$,
чтобы ошибка слежения была ограниченной.
В задаче консенсуса для многих агентов сформулировано только достаточное условие: 
действительная часть спектра матрицы $A$ не положительна.

\subsection{Нелинейный наблюдатель}
Строим каскадным наблюдателем нелинейную оценку для $e_1, e_2$.
И получаем новую оценку $\tilde{x}_i = \hat{x}_i + \hat{e}_i$.

\begin{equation*}
\begin{gathered}
    \begin{cases}
        \dot{x} = A x + B K (\tilde{x}_1 - w) + B K (\tilde{x}_2 - w)\\
        \dot{\hat{x}}_1 = A x_1 + 
            B K (\tilde{x}_1 - w) +
            F (C \hat{x}_1 - y)\\
        \dot{\hat{x}}_2 = A x_2 + 
            B K (\tilde{x}_2 - w) +
            F (C \hat{x}_2 - y)
    \end{cases}\\
    \Downarrow\\
    \begin{cases}
        \dot{e}_1 = (A + F C) e_1 + B K (\tilde{x}_2 - w)\\
        \dot{e}_2 = (A + F C) e_2 + B K (\tilde{x}_1 - w)\\
        \dot{\hat{e}}_1 = observer(\hat{e}_1, \hat{x}_1, y)\\
        \dot{\hat{e}}_2 = observer(\hat{e}_2, \hat{x}_2, y)\\
        \tilde{x}_1 = \hat{x}_1 + \hat{e}_1\\
        \tilde{x}_2 = \hat{x}_2 + \hat{e}_2
    \end{cases}
\end{gathered}
\end{equation*}

Есть две проблемы
\begin{enumerate}
    \item Помеха в наблюдателе зависит от $\hat{e}$.
    \item Каскадный наблюдатель рассчитан на ограниченную помеху,
    а в текущей системе есть переходные процессы.
\end{enumerate}

Моделирование показывает,
что если начальные условия близки к нулю,
и переходные процессы поэтому проходят с малой амплитудой,
то все работает.

Если начальные условия большие,
то переходные процессы занимают значительное время.
А при некоторых параметрах, система становится неустойчивой.

\subsubsection{Применение сатурации}

Как справится с начальными переходными процессами?
По сути в переходном процессе, если помеха превосходит ограничение,
заложенное в каскадном наблюдателе,
каскадный наблюдатель дает неверную оценку.
Результаты моделирования показывают,
что $||\hat{e} - e|| >> 0$.

Идея состоит в том, чтобы ``включить'' каскадный наблюдатель после 
завершения переходных процессов.
Один из возможных вариантов --- сатурация $\hat{e}$ в управлении.
\begin{equation*}
    \begin{gathered}
        \tilde{x}_1 = \hat{x}_1 + sat(\hat{e}_1, \lambda)\\
        \tilde{x}_2 = \hat{x}_2 + sat(\hat{e}_2, \lambda)
    \end{gathered}
\end{equation*}
Тогда в переходном процессе $sat(\hat{e})$ можно интерпретировать,
как ограниченную помеху.
Так как система устойчива, то после завершения переходного процесса
это приведет к ограниченной ошибке слежения и наблюдения и, следовательно, к ограниченному управлению.
Тогда каскадный наблюдатель начнет работать правильно 
и через какое-то время будет выдавать точную оценку.
Это можно назвать вторым переходным процессом.
По его завершению $\tilde{x}(t) = x(t)$.
\begin{equation*}
\begin{gathered}
    I:\ \exists T_1: \forall t > T_1 
        \Rightarrow ||u_1|| \le \alpha, ||u_2|| \le \alpha\\
    \Downarrow\\
    II:\ \exists T_2: \forall t > T_2
        \Rightarrow ||\hat{e}_1 - e_1|| \le \beta, ||\hat{e}_2 - e_2|| \le \beta
\end{gathered}
\end{equation*}

Константа $\alpha$ зависит от $w$ и ее можно регулировать
\begin{enumerate}
    \item Значением сатурации
    \item Выбором матриц $K$ и $F$
\end{enumerate}

Константа $\beta$ зависит от каскадного наблюдателя.
В идеальном случае она равна $0$.
В реальном скользящем режиме есть небольшие колебания относительно нуля.

Система для шага I (где каскадный наблюдатель - помеха в управлении)
\begin{equation*}
\begin{gathered}
    \dot{x} = A x + B u_1 + B u_2\\
    \dot{\hat{x}}_1 = A x_1 + 
        B u_1 +
        F (C \hat{x}_1 - y)\\
    \dot{\hat{x}}_2 = A x_2 + 
        B u_2 +
        F (C \hat{x}_2 - y)\\
    y = C x\\
    u_1 = K(\hat{x}_1 - w + \xi_1)\\
    u_2 = K(\hat{x}_2 - w + \xi_2)\\
    ||\xi_1||, ||\xi_2|| \le \lambda
\end{gathered}
\end{equation*}

Система для шага II (каскадный наблюдатель начинает работать)
\begin{equation*}
\begin{gathered}
    \dot{e}_1 = (A + F C) e_1 + B u_2\\
    \dot{e}_2 = (A + F C) e_2 + B u_1\\
    ||u_1||, ||u_2|| \le \alpha\\
    \dot{\hat{e}}_1 = observer(\hat{e}_1, C e_1)\\
    \dot{\hat{e}}_2 = observer(\hat{e}_2, C e_2)\\
    \hat{e}_1 \to e_1 + \varepsilon_1\\
    \hat{e}_2 \to e_2 + \varepsilon_2\\
    ||\varepsilon_1||, ||\varepsilon_2|| \le \beta
\end{gathered}
\end{equation*}

Система для шага III (будто знаем точное значение $x$)
\begin{equation*}
\begin{gathered}
    \dot{x} = A x + B u_1 + B u_2\\
    u_1 = K(x - w + \varepsilon_1)\\
    u_2 = K(x - w + \varepsilon_2)\\
    ||\varepsilon_1||, ||\varepsilon_2|| \le \beta
\end{gathered}
\end{equation*}

\subsubsection{Сокращение шага II}
Результаты моделирования показывают, что шаг II растянут по времени.
Это вызвано тем, что на первом шаге $\hat{e}$ успевает уйти далеко от $e$.

Так как результатом первого шага будет известное ограничение на $e: ||e|| \le \gamma$,
то нет смысла увеличивать $\hat{e}$ больше $\gamma$.
Пусть $observer_\gamma$ - каскадный наблюдатель,
но который не дает $\hat{e}$ выйти за пределы $||\hat{e}|| < \gamma$.
Этого можно добиться например сатурацией $\hat{e}$ после каждого шага интегрирования.
\begin{equation*}
    \hat{e}[t + dt] = sat(\hat{e}[t] + observer(\hat{e}[t], C e[t]) dt, \gamma)
\end{equation*}
Моделирование показывает, что такой наблюдатель тоже сходится к $e$,
но это, конечно, требует доказательства.

Раньше после первого шага было $||\hat{e} - e|| >> 0$, 
а сейчас $||\hat{e} - e|| < 2\gamma$.
Поэтому время шага II значительно сократилось.

\subsubsection{Моделирование нелинейного наблюдателя}
Когда начальные условия близки к нулю,
то шага I нет или он очень короткий,
поэтому сразу наблюдаем значительное улучшение по сравнению с линейным наблюдателем,
и даже со стандартным наблюдателем.

Когда переходные процессы длительны (шаг I),
то заметна сильная разница в разных подходах.

\end{document}
